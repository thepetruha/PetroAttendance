<!DOCTYPE html>
<html lang="en">
<head>
    <%- include("blocks/Head.ejs") %>   
</head>
<body>
    <header>
        <div class="container">
            <div class="group">
                <a href="/" class="back"></a>
                <h2><%= group %> </h2>
                <p><%= new Date().toLocaleString() %></p>
            </div>
        </div>
    </header>
    <% if(!numPar){%>
        <section id="update">
            <div class="container">
                <h3>Не выбрано количество пар.</h3>
                <a href="/select" class="btn">Выбрать</a>
            </div>
        </section>
    <% } else if(!isDate) { %> 
        <section id="update">
            <div class="container">
                <h3>Проставьте посещаемость:</h3>
                <nav>
                    <script>var users = {};</script>
                    <ul class="list">
                        <% if(allUsers) { %> 
                            <% allUsers.forEach((arr, index) => { %> 
                                <div class="flexable">
                                    <li><%= index + 1 %></li>
                                    <li><%= arr.dataValues.first_name %> <%= arr.dataValues.surname %></li>
                                </div>
                                <script>users['<%- arr.dataValues.id %>'] = {};</script>
                            <% }); %> 
                        <% } %> 
                    </ul> 
                    <div class="otm">
                        <% if(allUsers) { %> 
                            <% allUsers.forEach((arr, index) => { %> 
                                <ul class="checkbox-list" id="list<%- index %>">
                                    <% for(var i = 0; i < numPar; i++) { %>
                                        <li class="check" id="check<%- i %>"></li>
                                    <% } %> 
                                </ul>
                            <% }); %>
                        <% } %> 
                        <script>
                            function fixValue(){
                                var params = [];
                                var list = document.getElementsByClassName('checkbox-list');
                                for (let i = 0; i < list.length; i++) {
                                    var text = [];
                                    list[i].childNodes.forEach(obj => {
                                        if(obj.innerHTML != undefined){
                                            text.push(obj.innerHTML);
                                        }
                                    });
                                    params.push(text);
                                }

                                var iter = 0;
                                for(key in users){
                                    users[key] = params[iter]; 
                                    iter++;
                                    console.log(users);
                                }
                            }
                            var ch = document.querySelectorAll('.checkbox-list'); 
                            for (let i = 0; i < ch.length; i++) {
                                ch[i].childNodes.forEach(obj => {
                                    obj.addEventListener('click', event => {
                                        event.preventDefault();
                                        console.log(ch[i].id + " : " + obj.id + ":" + obj.innerHTML);
                                        
                                        if(obj.innerHTML == ""){
                                            obj.innerHTML = "H";
                                        }else if(obj.innerHTML == 'H'){
                                            obj.innerHTML = "Y";
                                        }else if(obj.innerHTML == 'Y'){
                                            obj.innerHTML = "";
                                        }
                                        fixValue();
                                    })
                                });
                            }
                        </script>
                    </div>
                </nav>        
                <br>     
                <button class="button" type="submit">Сохранить</button>
            </div>
        </section>    
        <%- include("blocks/FormationJsonSend.ejs") %>
    <% } else { %>
        <section>
            <div class="container">
                <h3>На сегодня посещаемость уже создана </h3>
            </div>
        </section>
    <% } %>  
</body>
</html>